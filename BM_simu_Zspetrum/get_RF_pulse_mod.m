function [omega_1, crush_counter_init, crush_counter_max, step_size, numPulse,tp,td] = get_RF_pulse_mod(input, numStep)

B1                = input.paramStruct.B1;
gyr               = input.paramStruct.gyr;
isGaussWave       = input.paramStruct.isGaussWave;


numPulse  = 10;       % number of pulse 
tp        = 0.097280; % 5120us*19, duration of each pulse, second
td        = 0.010;    % delay between each pulse, second
teile     = numStep;  % divide every pulse into how many pieces
tpulse    = tp/teile:tp/teile:tp;
step_size = tp/teile;

if ~isGaussWave % pulsed block
    omega_1_element = B1*2*pi*gyr*ones(1, tp/step_size);
else % pulsed Gaussian, pulse shape exported from IDEA's pulseTool
%     fname = 'GAUSS5120.B375.mat';
%     pulseStruct = load(fname);
%     original_RF_pulse = pulseStruct.RF_pulse;
%     original_RF_pulse = original_RF_pulse';
    

    original_RF_pulse = [0.000000000000000, 0.038578000000000, 0.039574001000000, 0.040591002000000, 0.041630000000000, 0.042691998000000, 0.043776002000000, 0.044883002000000, 0.046014000000000, 0.047168002000000, 0.048347000000000, 0.049550001000000, 0.050778002000000, 0.052030999000000, 0.053309001000000, 0.054614000000000, 0.055945002000000, 0.057303000000000, 0.058687001000000, 0.060100000000000, 0.061540000000000, 0.063008003000000, 0.064505003000000, 0.066030003000000, 0.067584999000000, 0.069169998000000, 0.070785001000000, 0.072430000000000, 0.074106000000000, 0.075814001000000, 0.077551998000000, 0.079323001000000... 
                        0.081125997000000, 0.082961999000000, 0.084830999000000, 0.086732998000000, 0.088669002000000, 0.090639003000000, 0.092643999000000, 0.094682999000000, 0.096758001000000, 0.098867998000000, 0.101014003000000, 0.103197001000000, 0.105416000000000, 0.107671998000000, 0.109964997000000, 0.112296000000000, 0.114665002000000, 0.117072001000000, 0.119516999000000, 0.122001998000000, 0.124525003000000, 0.127087995000000, 0.129691005000000, 0.132333994000000, 0.135016993000000, 0.137740999000000, 0.140505999000000, 0.143312007000000, 0.146158993000000, 0.149048001000000, 0.151978999000000, 0.154952005000000... 
                        0.157967001000000, 0.161025003000000, 0.164125994000000, 0.167269006000000, 0.170456007000000, 0.173685998000000, 0.176960006000000, 0.180277005000000, 0.183638006000000, 0.187042996000000, 0.190492004000000, 0.193985000000000, 0.197521999000000, 0.201104000000000, 0.204730004000000, 0.208400995000000, 0.212116003000000, 0.215875998000000, 0.219680995000000, 0.223529994000000, 0.227423996000000, 0.231362998000000, 0.235346004000000, 0.239373997000000, 0.243446007000000, 0.247563004000000, 0.251724988000000, 0.255930007000000, 0.260179996000000, 0.264474005000000, 0.268812001000000, 0.273193985000000... 
                        0.277619004000000, 0.282088012000000, 0.286599994000000, 0.291155010000000, 0.295753002000000, 0.300392985000000, 0.305076003000000, 0.309801012000000, 0.314567000000000, 0.319375008000000, 0.324223012000000, 0.329113007000000, 0.334042013000000, 0.339011997000000, 0.344020993000000, 0.349068999000000, 0.354155988000000, 0.359279990000000, 0.364443004000000, 0.369643003000000, 0.374879003000000, 0.380151004000000, 0.385459006000000, 0.390801996000000, 0.396180004000000, 0.401591003000000, 0.407034993000000, 0.412512004000000, 0.418020993000000, 0.423561007000000, 0.429131001000000, 0.434731007000000... 
                        0.440360010000000, 0.446016997000000, 0.451701999000000, 0.457412988000000, 0.463149995000000, 0.468912005000000, 0.474698991000000, 0.480508000000000, 0.486339986000000, 0.492193997000000, 0.498068005000000, 0.503961980000000, 0.509873986000000, 0.515805006000000, 0.521752000000000, 0.527714014000000, 0.533692002000000, 0.539682984000000, 0.545686007000000, 0.551701009000000, 0.557726979000000, 0.563762009000000, 0.569805026000000, 0.575855970000000, 0.581911981000000, 0.587972999000000, 0.594038010000000, 0.600106001000000, 0.606173992000000, 0.612242997000000, 0.618310988000000, 0.624375999000000... 
                        0.630437016000000, 0.636493981000000, 0.642543972000000, 0.648588002000000, 0.654622018000000, 0.660646021000000, 0.666658998000000, 0.672659993000000, 0.678646028000000, 0.684617996000000, 0.690572023000000, 0.696509004000000, 0.702426016000000, 0.708323002000000, 0.714197993000000, 0.720049024000000, 0.725875974000000, 0.731676996000000, 0.737450004000000, 0.743193984000000, 0.748907983000000, 0.754589975000000, 0.760239005000000, 0.765854001000000, 0.771434009000000, 0.776975989000000, 0.782478988000000, 0.787943006000000, 0.793365002000000, 0.798744977000000, 0.804080009000000, 0.809370995000000... 
                        0.814613998000000, 0.819809020000000, 0.824954987000000, 0.830051005000000, 0.835093021000000, 0.840083003000000, 0.845018029000000, 0.849896014000000, 0.854717016000000, 0.859480023000000, 0.864181995000000, 0.868824005000000, 0.873401999000000, 0.877916992000000, 0.882367015000000, 0.886750996000000, 0.891067028000000, 0.895314991000000, 0.899492979000000, 0.903599977000000, 0.907634020000000, 0.911596000000000, 0.915482998000000, 0.919294000000000, 0.923030019000000, 0.926687002000000, 0.930266023000000, 0.933764994000000, 0.937183022000000, 0.940519989000000, 0.943774998000000, 0.946945012000000... 
                        0.950030982000000, 0.953032017000000, 0.955946982000000, 0.958773971000000, 0.961513996000000, 0.964164972000000, 0.966726005000000, 0.969197989000000, 0.971578002000000, 0.973865986000000, 0.976063013000000, 0.978165984000000, 0.980175972000000, 0.982091010000000, 0.983911991000000, 0.985637009000000, 0.987267017000000, 0.988799989000000, 0.990235984000000, 0.991576016000000, 0.992816985000000, 0.993960977000000, 0.995006979000000, 0.995953023000000, 0.996801019000000, 0.997550011000000, 0.998199999000000, 0.998749018000000, 0.999198973000000, 0.999549985000000, 0.999800026000000, 0.999949992000000... 
                        1.000000000000000, 0.999949992000000, 0.999800026000000, 0.999549985000000, 0.999198973000000, 0.998749018000000, 0.998199999000000, 0.997550011000000, 0.996801019000000, 0.995953023000000, 0.995006979000000, 0.993960977000000, 0.992816985000000, 0.991576016000000, 0.990235984000000, 0.988799989000000, 0.987267017000000, 0.985637009000000, 0.983911991000000, 0.982091010000000, 0.980175972000000, 0.978165984000000, 0.976063013000000, 0.973865986000000, 0.971578002000000, 0.969197989000000, 0.966726005000000, 0.964164972000000, 0.961513996000000, 0.958773971000000, 0.955946982000000, 0.953032017000000... 
                        0.950030982000000, 0.946945012000000, 0.943774998000000, 0.940519989000000, 0.937183022000000, 0.933764994000000, 0.930266023000000, 0.926687002000000, 0.923030019000000, 0.919294000000000, 0.915482998000000, 0.911596000000000, 0.907634020000000, 0.903599977000000, 0.899492979000000, 0.895314991000000, 0.891067028000000, 0.886750996000000, 0.882367015000000, 0.877916992000000, 0.873401999000000, 0.868824005000000, 0.864181995000000, 0.859480023000000, 0.854717016000000, 0.849896014000000, 0.845018029000000, 0.840083003000000, 0.835093021000000, 0.830051005000000, 0.824954987000000, 0.819809020000000... 
                        0.814613998000000, 0.809370995000000, 0.804080009000000, 0.798744977000000, 0.793365002000000, 0.787943006000000, 0.782478988000000, 0.776975989000000, 0.771434009000000, 0.765854001000000, 0.760239005000000, 0.754589975000000, 0.748907983000000, 0.743193984000000, 0.737450004000000, 0.731676996000000, 0.725875974000000, 0.720049024000000, 0.714197993000000, 0.708323002000000, 0.702426016000000, 0.696509004000000, 0.690572023000000, 0.684617996000000, 0.678646028000000, 0.672659993000000, 0.666658998000000, 0.660646021000000, 0.654622018000000, 0.648588002000000, 0.642543972000000, 0.636493981000000... 
                        0.630437016000000, 0.624375999000000, 0.618310988000000, 0.612242997000000, 0.606173992000000, 0.600106001000000, 0.594038010000000, 0.587972999000000, 0.581911981000000, 0.575855970000000, 0.569805026000000, 0.563762009000000, 0.557726979000000, 0.551701009000000, 0.545686007000000, 0.539682984000000, 0.533692002000000, 0.527714014000000, 0.521752000000000, 0.515805006000000, 0.509873986000000, 0.503961980000000, 0.498068005000000, 0.492193997000000, 0.486339986000000, 0.480508000000000, 0.474698991000000, 0.468912005000000, 0.463149995000000, 0.457412988000000, 0.451701999000000, 0.446016997000000... 
                        0.440360010000000, 0.434731007000000, 0.429131001000000, 0.423561007000000, 0.418020993000000, 0.412512004000000, 0.407034993000000, 0.401591003000000, 0.396180004000000, 0.390801996000000, 0.385459006000000, 0.380151004000000, 0.374879003000000, 0.369643003000000, 0.364443004000000, 0.359279990000000, 0.354155988000000, 0.349068999000000, 0.344020993000000, 0.339011997000000, 0.334042013000000, 0.329113007000000, 0.324223012000000, 0.319375008000000, 0.314567000000000, 0.309801012000000, 0.305076003000000, 0.300392985000000, 0.295753002000000, 0.291155010000000, 0.286599994000000, 0.282088012000000... 
                        0.277619004000000, 0.273193985000000, 0.268812001000000, 0.264474005000000, 0.260179996000000, 0.255930007000000, 0.251724988000000, 0.247563004000000, 0.243446007000000, 0.239373997000000, 0.235346004000000, 0.231362998000000, 0.227423996000000, 0.223529994000000, 0.219680995000000, 0.215875998000000, 0.212116003000000, 0.208400995000000, 0.204730004000000, 0.201104000000000, 0.197521999000000, 0.193985000000000, 0.190492004000000, 0.187042996000000, 0.183638006000000, 0.180277005000000, 0.176960006000000, 0.173685998000000, 0.170456007000000, 0.167269006000000, 0.164125994000000, 0.161025003000000... 
                        0.157967001000000, 0.154952005000000, 0.151978999000000, 0.149048001000000, 0.146158993000000, 0.143312007000000, 0.140505999000000, 0.137740999000000, 0.135016993000000, 0.132333994000000, 0.129691005000000, 0.127087995000000, 0.124525003000000, 0.122001998000000, 0.119516999000000, 0.117072001000000, 0.114665002000000, 0.112296000000000, 0.109964997000000, 0.107671998000000, 0.105416000000000, 0.103197001000000, 0.101014003000000, 0.098867998000000, 0.096758001000000, 0.094682999000000, 0.092643999000000, 0.090639003000000, 0.088669002000000, 0.086732998000000, 0.084830999000000, 0.082961999000000... 
                        0.081125997000000, 0.079323001000000, 0.077551998000000, 0.075814001000000, 0.074106000000000, 0.072430000000000, 0.070785001000000, 0.069169998000000, 0.067584999000000, 0.066030003000000, 0.064505003000000, 0.063008003000000, 0.061540000000000, 0.060100000000000, 0.058687001000000, 0.057303000000000, 0.055945002000000, 0.054614000000000, 0.053309001000000, 0.052030999000000, 0.050778002000000, 0.049550001000000, 0.048347000000000, 0.047168002000000, 0.046014000000000, 0.044883002000000, 0.043776002000000, 0.042691998000000, 0.041630000000000, 0.040591002000000, 0.039574001000000, 0.000000000000000];

    if numel(original_RF_pulse)/numStep >= 1 % use less points
        RF_pulse = downsample(original_RF_pulse, numel(original_RF_pulse)/numStep);
    else
        RF_pulse = interp1(1:numel(original_RF_pulse), ...
                           original_RF_pulse, ...
                           linspace(1, numel(original_RF_pulse), numStep), ...
                           'cubic');
    end
     
    % flip-angle equivalent
%     omega_1_element = RF_pulse*(512/247.904572)*B1*2*pi*gyr;   
        
    % power equivalent
    rect_pulse_power = (B1*2*pi*gyr)^2*0.1; % amplitude normalized to 1, duration 0.1s
    gauss_pulse_power = trapz(tpulse, RF_pulse.^2);
    omega_1_element = RF_pulse*sqrt(rect_pulse_power/gauss_pulse_power);   
end

crush_counter_init = -(numel(omega_1_element) - nnz(omega_1_element));
crush_counter_max = ceil(td/step_size);
omega_1 = repmat([omega_1_element, zeros(1, crush_counter_max)],1,numPulse);

end